# Frontend handoff (API + UI contract)

This repo already contains a working Next.js dashboard under `frontend/`, but if you want a clean slate frontend generated by Gemini, the key integration surface is the FastAPI backend.

The canonical contract is the backend OpenAPI schema (`/openapi.json`). The examples below are illustrative payloads that match the current schema.

## Backend API contract

The backend serves an OpenAPI spec that can be used to auto-generate a typed client and/or as source of truth for UI generation:

- Swagger UI: `http://localhost:8000/docs`
- OpenAPI JSON: `http://localhost:8000/openapi.json`

All application endpoints are under the `/api` prefix.

### Endpoints

#### `GET /api/protocols`

Response shape:

```json
{
  "protocols": [
    {
      "name": "PancakeSwap V3",
      "apy": 12.5,
      "tvl": "$2.1B",
      "risk_score": 3,
      "is_active": false
    }
  ],
  "ai_status": "Optimal - No rebalance needed"
}
```

#### `GET /api/vault/status`

```json
{
  "balance": "10.5",
  "current_protocol": "PancakeSwap V3",
  "agent_initialized": true
}
```

`current_protocol` may be `null` if the AI agent is not initialized.
`agent_initialized` is `false` in that case.
When `agent_initialized` is `false`, the backend AI agent is not available or unhealthy (for example, missing `ANTHROPIC_API_KEY` or a recent cycle error).

The `agent_initialized` flag is the canonical source of truth for whether UIs should enable AI-dependent controls (like `POST /api/trigger-cycle`).

#### `GET /api/rebalances`

```json
{
  "rebalances": [
    {
      "timestamp": "2026-02-18T13:15:00+00:00",
      "from_protocol": "PancakeSwap V3",
      "to_protocol": "Venus",
      "amount": "All funds",
      "reason": "Rebalance to Venus for 3.2% improvement",
      "tx_hash": "0x0000000000000000000000000000000000000000000000000000000000000000"
    }
  ]
}
```

`timestamp` is an ISO 8601 datetime string in UTC. In the OpenAPI schema it is typed as `string` with `format: date-time`.
Clients should treat it as a JSON string and parse it only if needed for display/sorting.

#### `POST /api/trigger-cycle`

Response shape:

```json
{
  "status": "success",
  "message": "AI cycle triggered",
  "last_run": "2026-02-18T13:15:00+00:00"
}
```

`last_run` is either `null` or an ISO 8601 datetime string in UTC representing the most recent cycle attempt. In the OpenAPI schema it is typed as `string` with `format: date-time`.
Clients should treat it as a JSON string and parse it only if needed for display.

Error example:

```json
{
  "status": "error",
  "message": "AI agent not initialized",
  "last_run": null
}
```

## Frontend runtime configuration

The frontend should treat these as runtime-configurable (public) values:

```env
NEXT_PUBLIC_BACKEND_URL=http://localhost:8000
NEXT_PUBLIC_VAULT_ADDRESS=0x0000000000000000000000000000000000000000
NEXT_PUBLIC_BSC_RPC_URL=https://bsc-dataseed.binance.org/
```

## Current UI components (optional reference)

If you want to reuse existing components/styles, the current dashboard is composed from:

- `frontend/src/components/VaultStatus.tsx`
- `frontend/src/components/ProtocolCard.tsx`
- `frontend/src/components/RebalanceLog.tsx`
- `frontend/src/app/page.tsx`

Theme guidance lives in `UI_DESIGN.md`.
